
<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>åˆ†çµ„ç®¡ç†</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .player-tag {
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);
      border: 2px solid #60a5fa;
    }
    .group-slot .symbol {
      cursor: pointer;
    }
    .symbol-picker {
      position: absolute;
      display: none;
      z-index: 50;
    }
    .symbol-picker button {
      width: 3.0rem;
      height: 2.5rem;
      margin: 0.25rem;
      font-size: 1.25rem;
      font-family: revert;
      border: 1px solid #ccc;
      border-radius: 0.375rem;
      background-color: #f9fafb;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <h1 class="text-2xl font-bold mb-4 text-center">ğŸ“ åˆ†çµ„ç®¡ç†</h1>
  <div class='grid grid-cols-2 gap-6 bg-white p-6 rounded shadow-lg mb-6 relative'>
    <div id="symbol-picker" class="symbol-picker bg-white border rounded shadow p-2 flex flex-wrap w-64 hidden"></div>
<div class='col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4'>
<div id='Day-Beginner'><h2 class='font-semibold text-lg mb-2'>Day-Beginner</h2><div class='flex flex-wrap gap-2'><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>è¯å•Ÿæ¢…</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>é™¶å®¶æ¨‚</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>èƒ¡å°è“®</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>å­Ÿæ„›è²</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>æ—è‡»</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>èŠå®¶ç²</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>æ–½è“‰è“‰</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Beginner' draggable='true'>è”¡é„­ç¿ å„€</div></div></div><div id='Day-Advanced'><h2 class='font-semibold text-lg mb-2'>Day-Advanced</h2><div class='flex flex-wrap gap-2'><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Advanced' draggable='true'>ç¾…å¤©æ–‡</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Advanced' draggable='true'>Ping Lin</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Advanced' draggable='true'>é‚±å¦‚ç‰</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Day-Advanced' draggable='true'>è¬å…ƒèˆˆ</div></div></div><div id='Night-Beginner'><h2 class='font-semibold text-lg mb-2'>Night-Beginner</h2><div class='flex flex-wrap gap-2'><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>æ—å¯Œæ¡‚</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>å¾æ…¶å¦‚</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>Alexander Nguyen</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>Joy Liu</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>å³å°šçœŸ</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>æå€©</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>æº«å­Ÿç’‡</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Beginner' draggable='true'>Joseph Richardson</div></div></div><div id='Night-Advanced'><h2 class='font-semibold text-lg mb-2'>Night-Advanced</h2><div class='flex flex-wrap gap-2'><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Advanced' draggable='true'>å¼µç«‹æš</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Advanced' draggable='true'>William Hou</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Advanced' draggable='true'>æ¹¯å£«æ˜€</div><div class='player-tag px-3 py-1 bg-blue-100 text-blue-900 rounded-full cursor-move' data-group='Night-Advanced' draggable='true'>æ´ªåœ‹æ¬½</div></div></div></div>
    <div class="bg-slate-50 shadow-inner p-4 rounded border">
      <h2 class="text-lg font-semibold mb-4">Beginner</h2>
      <div class="space-y-3 group-type" id="beginner-groups" data-type="beginner">
    
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
      </div>
      <button onclick="addGroup('beginner-groups')" class="mt-3 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">æ–°å¢ç©ºé–“</button>
    </div>
    
    <div class="bg-slate-50 shadow-inner p-4 rounded border">
      <h2 class="text-lg font-semibold mb-4">Advanced</h2>
      <div class="space-y-3 group-type" id="advanced-groups" data-type="advanced">
    
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
        <div class="group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow">
          <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
          <div class="flex flex-wrap gap-2"></div>
          <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
        </div>
        
      </div>
      <button onclick="addGroup('advanced-groups')" class="mt-3 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">æ–°å¢ç©ºé–“</button>
    </div>
    </div>
<div class="mt-6 text-center">
  <button onclick="generateScheduleXMLFromGroups()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded shadow">
  ç”¢ç”Ÿè³½ç¨‹ XML
</button>
</div>
<script>
  const suits = ["â™ ï¸1", "â™ ï¸2", "â™ ï¸3", "â™ ï¸4", "â™¥ï¸1", "â™¥ï¸2", "â™¥ï¸3", "â™¥ï¸4", "â™¥ï¸5", "â™¥ï¸6", "â™¥ï¸7", "â™¥ï¸8"];
  let dragged = null;
  let currentSymbolBtn = null;

  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.player-tag').forEach(el => {
      el.addEventListener('dragstart', e => dragged = el);
    });
    document.querySelectorAll('.group-slot').forEach(slot => {
      slot.addEventListener('dragover', e => e.preventDefault());
      slot.addEventListener('drop', e => {
        e.preventDefault();
        if (dragged) slot.querySelector('div.flex').appendChild(dragged);
      });
    });

    const picker = document.getElementById("symbol-picker");
    suits.forEach(s => {
      const btn = document.createElement("button");
      btn.textContent = s;
      btn.onclick = () => {
        if (currentSymbolBtn) currentSymbolBtn.textContent = s;
        picker.classList.add('hidden'); picker.classList.remove('flex');
      };
      picker.appendChild(btn);
    });
  });

  function openSymbolPicker(button) {
    currentSymbolBtn = button;
    const picker = document.getElementById("symbol-picker");
    picker.classList.remove('hidden'); picker.classList.add('flex');
    const rect = button.getBoundingClientRect();
    picker.style.top = (window.scrollY + rect.bottom + 4) + 'px';
    picker.style.left = (window.scrollX + rect.left) + 'px';
  }

  function deleteTeam(teamElement) {
    // 1. æŠŠéšŠä¼è£¡çš„é¸æ‰‹é‚„åŸ
    const players = teamElement.querySelectorAll('.player-tag');
    players.forEach(player => {
      const group = player.getAttribute('data-group');
      const pool = document.getElementById(group);
      if (pool && pool.children.length >= 2) {
        const container = pool.children[1]; // ç¬¬äºŒå€‹ child æ˜¯é¸æ‰‹å€
        container.appendChild(player);
      }
    });

    // 2. å¾ DOM ä¸­ç§»é™¤æ•´å€‹éšŠä¼å…ƒç´ 
    teamElement.remove();
  }

  function addGroup(containerId) {
    const container = document.getElementById(containerId);
    
    const div = document.createElement('div');
    div.className = "group-slot flex items-center p-2 bg-white border-2 border-gray-300 rounded shadow mt-2";
    div.innerHTML = `
      <button onclick="openSymbolPicker(this)" class="symbol mr-4 w-16 h-10 flex items-center justify-center border border-gray-500 rounded text-xl">?</button>
      <div class="flex flex-wrap gap-2" ></div>
      <button onclick="deleteTeam(this.closest('.group-slot'))" class="top-1 right-1 text-red-500">âŒ</button>
    `;
    container.appendChild(div);

    div.addEventListener('dragover', e => e.preventDefault());
    div.addEventListener('drop', e => {
      e.preventDefault();
      if (dragged) div.querySelector('div.flex').appendChild(dragged);
    });
  }

  function generateXML() {
  let xml = '<?xml version="1.0" encoding="UTF-8"?>\n<groups>\n';
  document.querySelectorAll('.group-slot').forEach(slot => {
    const symbol = slot.querySelector('button.symbol')?.textContent.trim() || '?';
    const players = Array.from(slot.querySelectorAll('.player-tag')).map(p => p.textContent.trim());
    if (players.length > 0) {
      xml += `  <team id="${symbol}">\n`;
      players.forEach(p => {
        xml += `    <player>${p}</player>\n`;
      });
      xml += '  </team>\n';
    }
  });
  xml += '</groups>';
  console.log("ğŸ“‚ åˆ†çµ„ XML:");
  console.log(xml);
  alert("âœ… XML å·²é¡¯ç¤ºæ–¼ console");
}

// ğŸ”½ å‡è¨­ï¼šåˆ†çµ„å€å¡Šä¸­ï¼Œæ¯ä¸€å€‹ .group-slot ä»£è¡¨ä¸€çµ„éšŠä¼
//       æ¯å€‹ .group-slot è£¡é¢æœ‰ 2 å€‹ .playerï¼Œä¸¦ä¸” data-symbol å±¬æ€§ä»£è¡¨è©²éšŠä¼çš„åœ–ç¤º
// ğŸ”½ å‡è¨­ï¼šåˆ†çµ„å€å¡Šä¸­ï¼Œæ¯ä¸€å€‹ .group-slot ä»£è¡¨ä¸€çµ„éšŠä¼
//       æ¯å€‹ .group-slot è£¡é¢æœ‰ 2 å€‹ .playerï¼Œä¸¦ä¸” data-symbol å±¬æ€§ä»£è¡¨è©²éšŠä¼çš„åœ–ç¤º

function generateScheduleXMLFromGroups() {
  const beginnerCourts = ['A', 'B'];
  const advancedCourt = 'D';
  const courtMap = { A: [], B: [], D: [] };

  const slots = document.querySelectorAll('.group-slot');
  const beginnerTeams = [];
  const advancedTeams = [];

  slots.forEach(slot => {
    const symbol = slot.querySelector('button.symbol')?.textContent.trim() || '?';
    const players = [...slot.querySelectorAll('.player-tag')].map(p => p.innerText.trim()).filter(x => x);
    const type = slot.closest('.group-type').dataset.type; // beginner / advanced

    const team = {
      symbol,
      players,
    };

    if (type === 'beginner') beginnerTeams.push(team);
    else if (type === 'advanced') advancedTeams.push(team);
  });

  function getMatchups(teams) {
    const result = [];
    const n = teams.length;
    if (n < 4) {
      // å…¨å°å…¨
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          result.push([teams[i], teams[j]]);
        }
      }
    } else {
      // æ¯éšŠèˆ‡ä¸åŒå°æ‰‹æ‰“3å ´ï¼ˆç°¡å–®éš¨æ©ŸæŒ‘3å€‹ï¼‰
      for (let i = 0; i < n; i++) {
        const opponents = [...Array(n).keys()].filter(j => j !== i);
        const selected = opponents.slice(0, 3); // å¯åŠ éš¨æ©Ÿæ‰“äº‚
        selected.forEach(j => {
          if (i < j) result.push([teams[i], teams[j]]);
        });
      }
    }
    return result;
  }

  // ğŸ”„ å°‡ beginnerTeams åˆ†æˆå…©åŠä»¥å°æ‡‰å…©å€‹çƒå ´
  const half = Math.ceil(beginnerTeams.length / 2);
  const courtABeginnerTeams = beginnerTeams.slice(0, half);
  const courtBBeginnerTeams = beginnerTeams.slice(half);

  const beginnerMatchesA = getMatchups(courtABeginnerTeams);
  const beginnerMatchesB = getMatchups(courtBBeginnerTeams);
  const advancedMatches = getMatchups(advancedTeams);

  beginnerMatchesA.forEach((pair) => {
    courtMap['A'].push({
      teamL: pair[0],
      teamR: pair[1],
      isBeginner: true,
    });
  });

  beginnerMatchesB.forEach((pair) => {
    courtMap['B'].push({
      teamL: pair[0],
      teamR: pair[1],
      isBeginner: true,
    });
  });

  advancedMatches.forEach(pair => {
    courtMap[advancedCourt].push({
      teamL: pair[0],
      teamR: pair[1],
      isBeginner: false,
    });
  });

  // ğŸ”½ å»ºç«‹ XML å­—ä¸²
  let xml = `<?xml version="1.0" encoding="UTF-8"?>
<schedule>
<stage name="é è³½" active="True">
`;
  Object.entries(courtMap).forEach(([courtId, matches]) => {
    xml += `  <court name="Court ${courtId}">
`;
    matches.forEach(match => {
      const t1 = match.teamL;
      const t2 = match.teamR;
      xml += `    <match 
      teamL="${t1.symbol}" teamR="${t2.symbol}"
      teamLPlayer1="${t1.players[0] || ''}" teamLPlayer2="${t1.players[1] || ''}"
      teamRPlayer1="${t2.players[0] || ''}" teamRPlayer2="${t2.players[1] || ''}"
      court="${courtId}" teamLScore="" teamRScore=""
      isBeginner="${match.isBeginner}" round=""/>
`;
    });
    xml += `  </court>
`;
  });
  xml += '</stage>';
  xml += `<stage name="æ·˜æ±°è³½/å† äºè³½" active="False">
<court name="Court A">
<match teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="A" teamLScore="" teamRScore="" isBeginner="true" round=""/>
</court>
<court name="Court B">
<match teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="B" teamLScore="" teamRScore="" isBeginner="true" round=""/>
</court>
<court name="Court D">
<match teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
<match teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
<match  teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
</court>
</stage>`;

  xml += `<stage name="å† äºè³½" active="False">
<court name="Court A">
<match  teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="A" teamLScore="" teamRScore="" isBeginner="true" round=""/>
</court>
<court name="Court B"></court>
<court name="Court D">
<match  teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
<match  teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
<match  teamL="" teamR="" teamLPlayer1="" teamLPlayer2="" teamRPlayer1="" teamRPlayer2="" court="D" teamLScore="" teamRScore="" isBeginner="false" round=""/>
</court>
</stage>
`;
  
  xml += '</schedule>';

  console.log('ğŸ“„ è³½ç¨‹ XML:', xml);
  alert('âœ… å·²ç”¢ç”Ÿè³½ç¨‹ XMLï¼Œå¯æ–¼ console è¤‡è£½ã€‚');
}


</script>
</body>
</html>
